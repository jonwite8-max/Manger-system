{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto">
  <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">ğŸ›’ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ§Ù„Ù…ØµØ§Ø±ÙŠÙ</h1>
      <p class="text-gray-600 mt-2">Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø´ØªØ±ÙŠØ§Øª ÙˆØ±Ø´Ø© Ø§Ù„ØªÙ„Ø­ÙŠÙ…</p>
    </div>
    
    <div class="flex items-center gap-4">
      <!-- Ø²Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
      <div class="bg-white rounded-lg border border-gray-200 p-1 flex">
        <a href="{{ url_for('purchases', type='fixed') }}" 
           class="px-4 py-2 rounded-md transition-colors {% if purchase_type == 'fixed' %}bg-blue-500 text-white{% else %}text-gray-600 hover:bg-gray-50{% endif %}">
          Ù…Ø´ØªØ±ÙŠØ§Øª Ø«Ø§Ø¨ØªØ©
        </a>
        <a href="{{ url_for('purchases', type='variable') }}" 
           class="px-4 py-2 rounded-md transition-colors {% if purchase_type == 'variable' %}bg-blue-500 text-white{% else %}text-gray-600 hover:bg-gray-50{% endif %}">
          Ù…Ø´ØªØ±ÙŠØ§Øª Ù…ØªØºÙŠØ±Ø©
        </a>
      </div>
      
      <button onclick="showModal('addPurchaseModal')" class="btn-success flex items-center gap-2">
        <i class="fas fa-cart-plus"></i>
        Ø¥Ø¶Ø§ÙØ© Ø´Ø±Ø§Ø¡
      </button>
    </div>
  </div>

  <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
  <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
    <div class="card p-4 text-center">
      <div class="text-2xl font-bold text-blue-600">{{ purchases|length }}</div>
      <div class="text-sm text-gray-600 mt-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
    </div>
    <div class="card p-4 text-center">
      <div class="text-2xl font-bold text-green-600">{{ purchases|selectattr('status', 'equalto', 'paid')|list|length }}</div>
      <div class="text-sm text-gray-600 mt-1">Ù…Ø¯ÙÙˆØ¹Ø©</div>
    </div>
    <div class="card p-4 text-center">
      <div class="text-2xl font-bold text-red-600">{{ purchases|selectattr('status', 'equalto', 'unpaid')|list|length }}</div>
      <div class="text-sm text-gray-600 mt-1">ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©</div>
    </div>
    <div class="card p-4 text-center">
      <div class="text-2xl font-bold text-purple-600">{{ "%.2f"|format(purchases|sum(attribute='total_price')) }}</div>
      <div class="text-sm text-gray-600 mt-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø©</div>
    </div>
    <div class="card p-4 text-center">
      <div class="text-2xl font-bold text-orange-600" id="myPurchasesTotal">0</div>
      <div class="text-sm text-gray-600 mt-1">Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ</div>
    </div>
  </div>

  <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© -->
  <div class="card p-6 mb-6">
    <div class="grid grid-cols-1 lg:grid-cols-5 gap-4">
      <!-- Ø¨Ø­Ø« -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ” Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹</label>
        <input 
          type="text" 
          id="searchInput"
          placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯ØŒ Ø§Ù„Ù…Ù†ØªØ¬..."
          class="form-input"
        >
      </div>
      
      <!-- ØªØµÙÙŠØ© Ø¨Ø§Ù„Ù…ÙˆØ±Ø¯ -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ¢ Ø§Ù„Ù…ÙˆØ±Ø¯</label>
        <select id="supplierFilter" class="form-select">
          <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</option>
          {% for supplier in suppliers %}
          <option value="{{ supplier.name }}">{{ supplier.name }}</option>
          {% endfor %}
        </select>
      </div>
      
      <!-- ØªØµÙÙŠØ© Ø¨Ø§Ù„Ø­Ø§Ù„Ø© -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ’° Ø§Ù„Ø­Ø§Ù„Ø©</label>
        <select id="statusFilter" class="form-select">
          <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
          <option value="paid">Ù…Ø¯ÙÙˆØ¹Ø©</option>
          <option value="unpaid">ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©</option>
        </select>
      </div>

      <!-- ØªØµÙÙŠØ© Ø¨Ø§Ù„Ù…Ø´ØªØ±ÙŠ -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ‘¤ Ø§Ù„Ù…Ø´ØªØ±ÙŠ</label>
        <select id="buyerFilter" class="form-select">
          <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ†</option>
          <option value="Ø£Ù†Ø§">Ø£Ù†Ø§</option>
          <option value="Ø´Ø±ÙŠÙƒ">Ø´Ø±ÙŠÙƒ</option>
          <option value="Ø¹Ø§Ù…Ù„">Ø¹Ø§Ù…Ù„</option>
        </select>
      </div>

      <!-- ØªØµÙÙŠØ© Ø¨Ø§Ù„ÙØ¦Ø© -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“ Ø§Ù„ÙØ¦Ø©</label>
        <select id="categoryFilter" class="form-select">
          <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
          <option value="Ø­Ø¯ÙŠØ¯ ÙˆÙ…ÙˆØ§Ø¯ Ø£Ø³Ø§Ø³ÙŠØ©">Ø­Ø¯ÙŠØ¯ ÙˆÙ…ÙˆØ§Ø¯ Ø£Ø³Ø§Ø³ÙŠØ©</option>
          <option value="Ø¹ØªØ§Ø¯ ÙˆÙ…Ø­Ø±ÙƒØ§Øª">Ø¹ØªØ§Ø¯ ÙˆÙ…Ø­Ø±ÙƒØ§Øª</option>
          <option value="Ù…ØµØ§Ø±ÙŠÙ ØªØ±ÙƒÙŠØ¨">Ù…ØµØ§Ø±ÙŠÙ ØªØ±ÙƒÙŠØ¨</option>
          <option value="Ù…ØµØ§Ø±ÙŠÙ ØªØ´ØºÙŠÙ„">Ù…ØµØ§Ø±ÙŠÙ ØªØ´ØºÙŠÙ„</option>
          <option value="Ù…ØµØ§Ø±ÙŠÙ ØµÙŠØ§Ù†Ø©">Ù…ØµØ§Ø±ÙŠÙ ØµÙŠØ§Ù†Ø©</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø³Ù† -->
  <div class="table-container">
    <div class="overflow-x-auto">
      <table class="w-full min-w-[1200px]">
        <thead class="table-header">
          <tr>
            <th class="p-4 text-right">#</th>
            <th class="p-4 text-right">Ø§Ù„Ù…Ø´ØªØ±ÙŠ</th>
            <th class="p-4 text-right">Ø§Ù„Ù…ÙˆØ±Ø¯</th>
            <th class="p-4 text-right">Ø§Ù„Ù…Ù†ØªØ¬</th>
            <th class="p-4 text-right">Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ©</th>
            <th class="p-4 text-right">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
            <th class="p-4 text-right">Ø§Ù„ÙØ¦Ø©</th>
            <th class="p-4 text-right">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th class="p-4 text-right">Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th class="p-4 text-right">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</th>
          </tr>
        </thead>
        <tbody id="purchasesTable">
          {% for purchase in purchases %}
          <tr class="hover:bg-gray-50 transition-colors border-b border-gray-100 purchase-row" 
              data-buyer="{{ purchase.buyer or 'Ø£Ù†Ø§' }}"
              data-category="{{ purchase.category or 'Ø¹Ø§Ù…' }}"
              data-status="{{ purchase.status }}">
            <!-- Ø§Ù„Ø±Ù‚Ù… -->
            <td class="p-4">
              <div class="font-mono text-sm text-gray-500">#{{ purchase.id }}</div>
              {% if purchase.receipt_image %}
              <div class="mt-1">
                <button onclick="showReceiptImage('{{ purchase.receipt_image }}')" class="text-blue-600 hover:text-blue-800 text-xs">
                  <i class="fas fa-receipt"></i> ØµÙˆØ±Ø©
                </button>
              </div>
              {% endif %}
            </td>
            
            <!-- Ø§Ù„Ù…Ø´ØªØ±ÙŠ -->
            <td class="p-4">
              <div class="flex items-center gap-2">
                {% if purchase.buyer == 'Ø£Ù†Ø§' %}
                <span class="badge badge-success text-xs">Ø£Ù†Ø§</span>
                {% elif purchase.buyer == 'Ø´Ø±ÙŠÙƒ' %}
                <span class="badge badge-warning text-xs">Ø´Ø±ÙŠÙƒ</span>
                {% elif purchase.buyer == 'Ø¹Ø§Ù…Ù„' %}
                <span class="badge badge-info text-xs">Ø¹Ø§Ù…Ù„</span>
                {% else %}
                <span class="badge badge-secondary text-xs">{{ purchase.buyer or 'Ø£Ù†Ø§' }}</span>
                {% endif %}
              </div>
            </td>
            
            <!-- Ø§Ù„Ù…ÙˆØ±Ø¯ -->
            <td class="p-4">
              <div class="space-y-1">
                {% if purchase.supplier %}
                <div class="font-semibold text-gray-900">{{ purchase.supplier.name }}</div>
                <div class="text-xs text-gray-500">{{ purchase.supplier.phone }}</div>
                <button onclick="showPriceHistory({{ purchase.product_id }}, '{{ purchase.supplier.name }}')" 
                        class="text-blue-600 hover:text-blue-800 text-xs">
                  <i class="fas fa-chart-line"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
                </button>
                {% else %}
                <div class="text-gray-400 text-sm">Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ±Ø¯</div>
                {% endif %}
              </div>
            </td>
            
            <!-- Ø§Ù„Ù…Ù†ØªØ¬ -->
            <td class="p-4">
              <div class="font-medium text-gray-900">{{ purchase.product.name }}</div>
              <div class="text-xs text-gray-500">{{ purchase.product.category }}</div>
            </td>
            
            <!-- Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ© -->
            <td class="p-4">
              <div class="space-y-1 text-sm">
                <div class="flex justify-between">
                  <span class="text-gray-600">Ø§Ù„Ø³Ø¹Ø±:</span>
                  <span class="font-semibold text-green-600">{{ "%.2f"|format(purchase.price) }} Ø¯Ø¬</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Ø§Ù„ÙƒÙ…ÙŠØ©:</span>
                  <span class="font-semibold text-blue-600">{{ purchase.quantity }}</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-600">Ø§Ù„ÙˆØ­Ø¯Ø©:</span>
                  <span class="font-semibold text-gray-600">{{ purchase.unit or 'Ù‚Ø·Ø¹Ø©' }}</span>
                </div>
              </div>
            </td>
            
            <!-- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ -->
            <td class="p-4">
              <div class="text-center">
                <div class="text-lg font-bold text-purple-600">{{ "%.2f"|format(purchase.total_price) }} Ø¯Ø¬</div>
                <div class="text-xs text-gray-500">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</div>
              </div>
            </td>

            <!-- Ø§Ù„ÙØ¦Ø© -->
            <td class="p-4">
              <span class="inline-block px-2 py-1 text-xs rounded-full 
                {% if purchase.category == 'Ø­Ø¯ÙŠØ¯ ÙˆÙ…ÙˆØ§Ø¯ Ø£Ø³Ø§Ø³ÙŠØ©' %}bg-red-100 text-red-800
                {% elif purchase.category == 'Ø¹ØªØ§Ø¯ ÙˆÙ…Ø­Ø±ÙƒØ§Øª' %}bg-blue-100 text-blue-800
                {% elif purchase.category == 'Ù…ØµØ§Ø±ÙŠÙ ØªØ±ÙƒÙŠØ¨' %}bg-green-100 text-green-800
                {% elif purchase.category == 'Ù…ØµØ§Ø±ÙŠÙ ØªØ´ØºÙŠÙ„' %}bg-orange-100 text-orange-800
                {% elif purchase.category == 'Ù…ØµØ§Ø±ÙŠÙ ØµÙŠØ§Ù†Ø©' %}bg-purple-100 text-purple-800
                {% else %}bg-gray-100 text-gray-800{% endif %}">
                {{ purchase.category or 'Ø¹Ø§Ù…' }}
              </span>
            </td>
            
            <!-- Ø§Ù„ØªØ§Ø±ÙŠØ® -->
            <td class="p-4">
              <div class="text-sm text-gray-700">{{ purchase.purchase_date.strftime('%Y-%m-%d') }}</div>
              <div class="text-xs text-gray-500">{{ purchase.created_at.strftime('%H:%M') }}</div>
            </td>
            
            <!-- Ø§Ù„Ø­Ø§Ù„Ø© -->
            <td class="p-4">
              {% if purchase.status == 'paid' %}
              <span class="badge badge-success">Ù…Ø¯ÙÙˆØ¹Ø©</span>
              {% else %}
              <span class="badge badge-danger">ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©</span>
              {% endif %}
            </td>
            
            <!-- Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
            <td class="p-4">
              <div class="flex flex-col gap-2">
                <!-- Ø¯ÙØ¹ -->
                {% if purchase.status == 'unpaid' %}
                <a href="{{ url_for('mark_purchase_paid', id=purchase.id) }}" 
                   onclick="return confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ¹ÙŠÙŠÙ† Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙƒÙ…Ø¯ÙÙˆØ¹Ø©ØŸ')"
                   class="flex items-center gap-2 text-green-600 hover:text-green-800 p-2 rounded-lg hover:bg-green-50 transition-colors text-sm">
                  <i class="fas fa-check text-xs"></i>
                  ØªØ¹ÙŠÙŠÙ† ÙƒÙ…Ø¯ÙÙˆØ¹Ø©
                </a>
                {% endif %}
                
                <!-- Ø­Ø°Ù -->
                <a href="{{ url_for('delete_purchase', id=purchase.id) }}" 
                   onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ')"
                   class="flex items-center gap-2 text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-red-50 transition-colors text-sm">
                  <i class="fas fa-trash text-xs"></i>
                  Ø­Ø°Ù
                </a>
              </div>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="10" class="p-12 text-center">
              <div class="flex flex-col items-center justify-center">
                <i class="fas fa-cart-shopping text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-500 mb-2">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´ØªØ±ÙŠØ§Øª Ù…Ø³Ø¬Ù„Ø©</h3>
                <p class="text-gray-400 mb-6">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡</p>
                <button onclick="showModal('addPurchaseModal')" class="btn-primary flex items-center gap-2">
                  <i class="fas fa-cart-plus"></i>
                  Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ø´Ø±Ø§Ø¡
                </button>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Ø§Ù„ØªØ±Ù‚ÙŠÙ… -->
  <div class="flex justify-between items-center mt-6">
    <div class="text-sm text-gray-600">
      Ø¹Ø±Ø¶ <span class="font-semibold">{{ purchases|length }}</span> Ù…Ù† Ø£ØµÙ„ <span class="font-semibold">{{ purchases|length }}</span> Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡
    </div>
    <div class="pagination">
      <button class="page-item">
        <i class="fas fa-chevron-right"></i>
      </button>
      <button class="page-item active">1</button>
      <button class="page-item">2</button>
      <button class="page-item">3</button>
      <button class="page-item">
        <i class="fas fa-chevron-left"></i>
      </button>
    </div>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ø¶Ø§ÙØ© Ø´Ø±Ø§Ø¡ Ù…Ø­Ø³Ù† -->
<div id="addPurchaseModal" class="modal">
  <div class="modal-content w-full max-w-4xl">
    <div class="p-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-xl font-bold text-gray-900">ğŸ›ï¸ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <button onclick="hideModal('addPurchaseModal')" class="text-gray-400 hover:text-gray-600 text-xl">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form method="POST" action="{{ url_for('add_purchase') }}" class="space-y-6" id="purchaseForm" enctype="multipart/form-data">
        <input type="hidden" name="type" value="{{ purchase_type }}">
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© -->
          <div class="space-y-4">
            <h4 class="font-semibold text-gray-900 border-b pb-2">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠ</h4>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ø´ØªØ±ÙŠ *</label>
              <select name="buyer" required class="form-select">
                <option value="Ø£Ù†Ø§">Ø£Ù†Ø§</option>
                <option value="Ø´Ø±ÙŠÙƒ">Ø´Ø±ÙŠÙƒ</option>
                <option value="Ø¹Ø§Ù…Ù„">Ø¹Ø§Ù…Ù„</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ÙØ¦Ø© Ø§Ù„Ù…ØµØ±ÙˆÙ *</label>
              <select name="category" required class="form-select">
                <option value="Ø­Ø¯ÙŠØ¯ ÙˆÙ…ÙˆØ§Ø¯ Ø£Ø³Ø§Ø³ÙŠØ©">Ø­Ø¯ÙŠØ¯ ÙˆÙ…ÙˆØ§Ø¯ Ø£Ø³Ø§Ø³ÙŠØ©</option>
                <option value="Ø¹ØªØ§Ø¯ ÙˆÙ…Ø­Ø±ÙƒØ§Øª">Ø¹ØªØ§Ø¯ ÙˆÙ…Ø­Ø±ÙƒØ§Øª</option>
                <option value="Ù…ØµØ§Ø±ÙŠÙ ØªØ±ÙƒÙŠØ¨">Ù…ØµØ§Ø±ÙŠÙ ØªØ±ÙƒÙŠØ¨</option>
                <option value="Ù…ØµØ§Ø±ÙŠÙ ØªØ´ØºÙŠÙ„">Ù…ØµØ§Ø±ÙŠÙ ØªØ´ØºÙŠÙ„</option>
                <option value="Ù…ØµØ§Ø±ÙŠÙ ØµÙŠØ§Ù†Ø©">Ù…ØµØ§Ø±ÙŠÙ ØµÙŠØ§Ù†Ø©</option>
                <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
              </select>
            </div>
          </div>

          <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ -->
          <div class="space-y-4">
            <h4 class="font-semibold text-gray-900 border-b pb-2">ğŸ¢ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h4>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯</label>
              <select name="supplier_id" class="form-select" id="supplierSelect" onchange="loadSupplierInfo(this.value)">
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ±Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) --</option>
                {% for supplier in suppliers %}
                <option value="{{ supplier.id }}" data-phone="{{ supplier.phone }}" data-address="{{ supplier.address }}">
                  {{ supplier.name }}
                </option>
                {% endfor %}
              </select>
              <div class="text-xs text-gray-500 mt-1">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø­Ù‚Ù„ ÙØ§Ø±ØºØ§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…ÙˆØ±Ø¯ Ù…Ø­Ø¯Ø¯</div>
            </div>
            
            <div id="supplierInfo" class="bg-gray-50 rounded-lg p-4 hidden">
              <div class="space-y-2 text-sm">
                <div class="flex items-center gap-2">
                  <i class="fas fa-phone text-green-600"></i>
                  <span id="supplierPhone" class="text-gray-700"></span>
                </div>
                <div class="flex items-center gap-2">
                  <i class="fas fa-map-marker-alt text-red-600"></i>
                  <span id="supplierAddress" class="text-gray-700"></span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬ -->
          <div class="space-y-4">
            <h4 class="font-semibold text-gray-900 border-b pb-2">ğŸ“¦ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</h4>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ù†ØªØ¬ *</label>
              <select name="product_id" required class="form-select" id="productSelect" onchange="loadProductHistory(this.value)">
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬ --</option>
                {% for product in products %}
                <option value="{{ product.id }}">{{ product.name }} - {{ product.category }}</option>
                {% endfor %}
              </select>
            </div>

            <div id="productHistory" class="bg-blue-50 rounded-lg p-4 hidden">
              <h5 class="font-semibold text-blue-800 mb-2 text-sm">ğŸ“Š Ø¢Ø®Ø± Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</h5>
              <div id="priceHistoryContent" class="text-xs text-blue-700 space-y-1"></div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ (Ø¯Ø¬) *</label>
              <input type="number" step="0.01" name="price" required class="form-input" placeholder="0.00" min="0" id="priceInput" oninput="calculateTotal()">
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„ÙƒÙ…ÙŠØ© *</label>
                <input type="number" name="quantity" value="1" required class="form-input" min="1" id="quantityInput" oninput="calculateTotal()">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                <select name="unit" class="form-select">
                  <option value="Ù‚Ø·Ø¹Ø©">Ù‚Ø·Ø¹Ø©</option>
                  <option value="ÙƒÙŠÙ„Ùˆ">ÙƒÙŠÙ„Ùˆ</option>
                  <option value="Ù…ØªØ±">Ù…ØªØ±</option>
                  <option value="Ù„ØªØ±">Ù„ØªØ±</option>
                  <option value="Ø¹Ù„Ø¨Ø©">Ø¹Ù„Ø¨Ø©</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© -->
          <div class="space-y-4">
            <h4 class="font-semibold text-gray-900 border-b pb-2">ğŸ“… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h4>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡ *</label>
              <input type="date" name="purchase_date" required class="form-input" value="{{ now.strftime('%Y-%m-%d') if now else '' }}">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ *</label>
              <select name="status" required class="form-select" id="statusSelect" onchange="updateStatusPreview()">
                <option value="paid">Ù…Ø¯ÙÙˆØ¹Ø©</option>
                <option value="unpaid">ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø© (Ø¯ÙŠÙ†)</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ØµÙˆØ±Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <input type="file" name="receipt_image" accept="image/*" class="form-input">
              <div class="text-xs text-gray-500 mt-1">ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
              <textarea name="notes" class="form-input" rows="3" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø­ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡..."></textarea>
            </div>
          </div>
        </div>

        <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ -->
        <div class="bg-blue-50 rounded-lg p-4 mt-4">
          <h4 class="font-semibold text-gray-900 mb-3">ğŸ§® Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø­Ø³Ø§Ø¨</h4>
          <div class="grid grid-cols-2 md:grid-cols-5 gap-4 text-sm">
            <div class="text-center">
              <div class="text-gray-600">Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</div>
              <div id="previewPrice" class="font-semibold text-green-600">0.00 Ø¯Ø¬</div>
            </div>
            <div class="text-center">
              <div class="text-gray-600">Ø§Ù„ÙƒÙ…ÙŠØ©</div>
              <div id="previewQuantity" class="font-semibold text-blue-600">1</div>
            </div>
            <div class="text-center">
              <div class="text-gray-600">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
              <div id="previewTotal" class="font-bold text-purple-600 text-lg">0.00 Ø¯Ø¬</div>
            </div>
            <div class="text-center">
              <div class="text-gray-600">Ø§Ù„Ø­Ø§Ù„Ø©</div>
              <div id="previewStatus" class="font-semibold text-orange-600">Ù…Ø¯ÙÙˆØ¹Ø©</div>
            </div>
            <div class="text-center">
              <div class="text-gray-600">Ø§Ù„ÙØ¦Ø©</div>
              <div id="previewCategory" class="font-semibold text-red-600">Ø­Ø¯ÙŠØ¯ ÙˆÙ…ÙˆØ§Ø¯ Ø£Ø³Ø§Ø³ÙŠØ©</div>
            </div>
          </div>
        </div>

        <div class="flex justify-end gap-3 pt-6 border-t">
          <button type="button" onclick="hideModal('addPurchaseModal')" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
            Ø¥Ù„ØºØ§Ø¡
          </button>
          <button type="submit" class="btn-success flex items-center gap-2">
            <i class="fas fa-save"></i>
            Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
<div id="receiptImageModal" class="modal">
  <div class="modal-content w-full max-w-2xl">
    <div class="p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-gray-900">ğŸ§¾ ØµÙˆØ±Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
        <button onclick="hideModal('receiptImageModal')" class="text-gray-400 hover:text-gray-600 text-xl">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="receiptImageContent" class="text-center">
        <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§ -->
      </div>
    </div>
  </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
<div id="priceHistoryModal" class="modal">
  <div class="modal-content w-full max-w-2xl">
    <div class="p-6">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-xl font-bold text-gray-900">ğŸ“Š ØªØ§Ø±ÙŠØ® Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ù†ØªØ¬</h3>
        <button onclick="hideModal('priceHistoryModal')" class="text-gray-400 hover:text-gray-600 text-xl">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="priceHistoryContent">
        <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù‡Ù†Ø§ -->
      </div>
    </div>
  </div>
</div>

<script>
// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
let currentProductId = null;

// Ø¯Ø§Ù„Ø© Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
function showModal(modalId) {
    document.getElementById(modalId).classList.add('active');
    document.body.style.overflow = 'hidden';
}

function hideModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
    document.body.style.overflow = 'auto';
}

// Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯
function loadSupplierInfo(supplierId) {
    const supplierSelect = document.getElementById('supplierSelect');
    const selectedOption = supplierSelect.options[supplierSelect.selectedIndex];
    const supplierInfo = document.getElementById('supplierInfo');
    
    if (supplierId && selectedOption) {
        const phone = selectedOption.getAttribute('data-phone');
        const address = selectedOption.getAttribute('data-address');
        
        document.getElementById('supplierPhone').textContent = phone || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
        document.getElementById('supplierAddress').textContent = address || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
        supplierInfo.classList.remove('hidden');
    } else {
        supplierInfo.classList.add('hidden');
    }
}

// Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ ØªØ§Ø±ÙŠØ® Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ù†ØªØ¬
function loadProductHistory(productId) {
    const productHistory = document.getElementById('productHistory');
    const content = document.getElementById('priceHistoryContent');
    
    if (productId) {
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¹Ø§Ø± (Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…)
        const sampleData = `
            <div class="space-y-2">
                <div class="flex justify-between text-sm">
                    <span>Ø§Ù„Ù…ÙˆØ±Ø¯ Ø£</span>
                    <span class="font-semibold">450.00 Ø¯Ø¬</span>
                    <span class="text-gray-500">2024-01-15</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span>Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¨</span>
                    <span class="font-semibold">430.00 Ø¯Ø¬</span>
                    <span class="text-gray-500">2024-01-10</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span>Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¬</span>
                    <span class="font-semibold">460.00 Ø¯Ø¬</span>
                    <span class="text-gray-500">2024-01-05</span>
                </div>
            </div>
        `;
        
        content.innerHTML = sampleData;
        productHistory.classList.remove('hidden');
    } else {
        productHistory.classList.add('hidden');
    }
}

// Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
function calculateTotal() {
    const price = parseFloat(document.getElementById('priceInput').value) || 0;
    const quantity = parseInt(document.getElementById('quantityInput').value) || 1;
    const total = price * quantity;
    
    document.getElementById('previewPrice').textContent = price.toFixed(2) + ' Ø¯Ø¬';
    document.getElementById('previewQuantity').textContent = quantity;
    document.getElementById('previewTotal').textContent = total.toFixed(2) + ' Ø¯Ø¬';
}

// Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„ÙØ¦Ø©
function updateStatusPreview() {
    const statusSelect = document.getElementById('statusSelect');
    const categorySelect = document.querySelector('select[name="category"]');
    
    const status = statusSelect.options[statusSelect.selectedIndex].text;
    const category = categorySelect.options[categorySelect.selectedIndex].text;
    
    document.getElementById('previewStatus').textContent = status;
    document.getElementById('previewCategory').textContent = category;
}

// Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
function showReceiptImage(imageUrl) {
    const content = document.getElementById('receiptImageContent');
    content.innerHTML = `
        <img src="${imageUrl}" alt="ØµÙˆØ±Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©" class="max-w-full h-auto rounded-lg shadow-lg mx-auto">
        <div class="mt-4">
            <a href="${imageUrl}" download class="btn-primary inline-flex items-center gap-2">
                <i class="fas fa-download"></i>
                ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
            </a>
        </div>
    `;
    showModal('receiptImageModal');
}

// Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
function showPriceHistory(productId, supplierName) {
    const content = document.getElementById('priceHistoryContent');
    
    // Ù…Ø­Ø§ÙƒØ§Ø© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
    const historyData = `
        <div class="space-y-4">
            <div class="bg-gray-50 rounded-lg p-4">
                <h4 class="font-semibold text-gray-900 mb-3">ğŸ“ˆ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</h4>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between items-center p-2 bg-white rounded">
                        <span>${supplierName}</span>
                        <span class="font-bold text-green-600">450.00 Ø¯Ø¬</span>
                        <span class="text-gray-500">Ø§Ù„Ø­Ø§Ù„ÙŠ</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-white rounded">
                        <span>Ø§Ù„Ù…ÙˆØ±Ø¯ Ø£</span>
                        <span class="font-bold text-blue-600">430.00 Ø¯Ø¬</span>
                        <span class="text-gray-500">Ø£Ù‚Ù„ Ø³Ø¹Ø±</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-white rounded">
                        <span>Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¨</span>
                        <span class="font-bold text-orange-600">460.00 Ø¯Ø¬</span>
                        <span class="text-gray-500">Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø±</span>
                    </div>
                </div>
            </div>
            
            <div class="bg-blue-50 rounded-lg p-4">
                <h4 class="font-semibold text-blue-900 mb-2">ğŸ“… Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ</h4>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span>2024-01-15</span>
                        <span>450.00 Ø¯Ø¬</span>
                        <span>${supplierName}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>2024-01-10</span>
                        <span>445.00 Ø¯Ø¬</span>
                        <span>${supplierName}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>2024-01-05</span>
                        <span>440.00 Ø¯Ø¬</span>
                        <span>${supplierName}</span>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    content.innerHTML = historyData;
    showModal('priceHistoryModal');
}

// Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
function initSearchAndFilter() {
    const searchInput = document.getElementById('searchInput');
    const supplierFilter = document.getElementById('supplierFilter');
    const statusFilter = document.getElementById('statusFilter');
    const buyerFilter = document.getElementById('buyerFilter');
    const categoryFilter = document.getElementById('categoryFilter');
    
    const rows = document.querySelectorAll('#purchasesTable .purchase-row');
    
    function filterRows() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedSupplier = supplierFilter.value;
        const selectedStatus = statusFilter.value;
        const selectedBuyer = buyerFilter.value;
        const selectedCategory = categoryFilter.value;
        
        rows.forEach(row => {
            const rowText = row.textContent.toLowerCase();
            const rowSupplier = row.querySelector('td:nth-child(3) .font-semibold')?.textContent || '';
            const rowStatus = row.getAttribute('data-status');
            const rowBuyer = row.getAttribute('data-buyer');
            const rowCategory = row.getAttribute('data-category');
            
            const matchesSearch = searchTerm === '' || rowText.includes(searchTerm);
            const matchesSupplier = selectedSupplier === '' || rowSupplier === selectedSupplier || (selectedSupplier === '' && rowSupplier === 'Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ±Ø¯');
            const matchesStatus = selectedStatus === '' || rowStatus === selectedStatus;
            const matchesBuyer = selectedBuyer === '' || rowBuyer === selectedBuyer;
            const matchesCategory = selectedCategory === '' || rowCategory === selectedCategory;
            
            row.style.display = (matchesSearch && matchesSupplier && matchesStatus && matchesBuyer && matchesCategory) ? '' : 'none';
        });
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    searchInput.addEventListener('input', filterRows);
    supplierFilter.addEventListener('change', filterRows);
    statusFilter.addEventListener('change', filterRows);
    buyerFilter.addEventListener('change', filterRows);
    categoryFilter.addEventListener('change', filterRows);
}

// Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø´ØªØ±ÙŠØ§ØªÙŠ
function calculateMyPurchases() {
    const myPurchases = Array.from(document.querySelectorAll('.purchase-row'))
        .filter(row => row.getAttribute('data-buyer') === 'Ø£Ù†Ø§')
        .reduce((total, row) => {
            const priceElement = row.querySelector('td:nth-child(6) .text-lg');
            if (priceElement) {
                const price = parseFloat(priceElement.textContent.replace(' Ø¯Ø¬', '')) || 0;
                return total + price;
            }
            return total;
        }, 0);
    
    document.getElementById('myPurchasesTotal').textContent = myPurchases.toFixed(2);
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù‚ÙŠÙ…
    document.getElementById('priceInput')?.addEventListener('input', calculateTotal);
    document.getElementById('quantityInput')?.addEventListener('input', calculateTotal);
    document.getElementById('statusSelect')?.addEventListener('change', updateStatusPreview);
    document.querySelector('select[name="category"]')?.addEventListener('change', updateStatusPreview);
    
    // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
    calculateTotal();
    updateStatusPreview();
    initSearchAndFilter();
    calculateMyPurchases();
    
    // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… ÙƒÙ‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    const today = new Date().toISOString().split('T')[0];
    const dateInput = document.querySelector('input[name="purchase_date"]');
    if (dateInput && !dateInput.value) {
        dateInput.value = today;
    }
});

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
document.addEventListener('click', function(event) {
    if (event.target.classList.contains('modal')) {
        hideModal(event.target.id);
    }
});

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§Ù„Ø²Ø± Escape
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        document.querySelectorAll('.modal.active').forEach(modal => {
            hideModal(modal.id);
        });
    }
});
</script>

<style>
/* ØªØ®ØµÙŠØµ Ø¥Ø¶Ø§ÙÙŠ Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª */
.table-container {
  max-height: 600px;
  overflow-y: auto;
  border-radius: 12px;
}

.table th {
  position: sticky;
  top: 0;
  background: #f8fafc;
  z-index: 10;
  box-shadow: 0 1px 0 #e2e8f0;
}

/* ØªØ®ØµÙŠØµ Ø§Ù„Ø¨Ø§Ø¯Ø¬Ø§Øª */
.badge {
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
  text-align: center;
  display: inline-block;
}

.badge-success { background: #dcfce7; color: #166534; }
.badge-warning { background: #fef3c7; color: #92400e; }
.badge-danger { background: #fee2e2; color: #991b1b; }
.badge-info { background: #dbeafe; color: #1e40af; }
.badge-secondary { background: #f3f4f6; color: #374151; }

/* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¬Ø§ÙˆØ¨ */
@media (max-width: 768px) {
  .table-container {
    font-size: 0.8rem;
  }
  
  .modal-content {
    margin: 10px;
    width: calc(100% - 20px);
  }
}
</style>
{% endblock %}