{% extends "base.html" %}

{% block content %}
<div class="max-w-7xl mx-auto">
  <!-- ุฑุฃุณ ุงูุตูุญุฉ -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">๐ ููุญุฉ ุงูุฅุญุตุงุฆูุงุช</h1>
    <p class="text-gray-600 mt-2">ูุธุฑุฉ ุดุงููุฉ ุนูู ุฅุญุตุงุฆูุงุช ูุฃุฏุงุก ุงููุธุงู</p>
  </div>

  <!-- ุจุทุงูุงุช ุงูุฅุญุตุงุฆูุงุช ุงูุฑุฆูุณูุฉ -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- ุงูุทูุจูุงุช -->
    <div class="card p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">ุฅุฌูุงูู ุงูุทูุจูุงุช</p>
          <p class="text-2xl font-bold text-gray-900 mt-2">{{ total_orders }}</p>
          <div class="flex items-center mt-2">
            <span class="text-xs text-green-600 bg-green-100 px-2 py-1 rounded-full">
              {{ "%.1f"|format((paid_orders / total_orders * 100) if total_orders > 0 else 0) }}% ูุฏููุนุฉ
            </span>
          </div>
        </div>
        <div class="p-3 bg-blue-100 rounded-full">
          <i class="fas fa-box text-blue-600 text-xl"></i>
        </div>
      </div>
    </div>

    <!-- ุงูุนูุงู -->
    <div class="card p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">ุฅุฌูุงูู ุงูุนูุงู</p>
          <p class="text-2xl font-bold text-gray-900 mt-2">{{ total_workers }}</p>
          <div class="flex items-center mt-2">
            <span class="text-xs text-purple-600 bg-purple-100 px-2 py-1 rounded-full">
              {{ "%.2f"|format(total_salaries) }} ุฏุฌ ูุณุชุญูุฉ
            </span>
          </div>
        </div>
        <div class="p-3 bg-green-100 rounded-full">
          <i class="fas fa-users text-green-600 text-xl"></i>
        </div>
      </div>
    </div>

    <!-- ุงูุฏููู -->
    <div class="card p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">ุงูุฏููู ุงููุณุชุญูุฉ</p>
          <p class="text-2xl font-bold text-gray-900 mt-2">{{ total_debts }}</p>
          <div class="flex items-center mt-2">
            <span class="text-xs text-red-600 bg-red-100 px-2 py-1 rounded-full">
              {{ "%.2f"|format(total_debts_amount) }} ุฏุฌ
            </span>
          </div>
        </div>
        <div class="p-3 bg-red-100 rounded-full">
          <i class="fas fa-money-bill-wave text-red-600 text-xl"></i>
        </div>
      </div>
    </div>

    <!-- ุงููุดุชุฑูุงุช -->
    <div class="card p-6">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">ุฅุฌูุงูู ุงููุดุชุฑูุงุช</p>
          <p class="text-2xl font-bold text-gray-900 mt-2">{{ total_purchases }}</p>
          <div class="flex items-center mt-2">
            <span class="text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded-full">
              {{ fixed_purchases }} ุซุงุจุชุฉ
            </span>
          </div>
        </div>
        <div class="p-3 bg-purple-100 rounded-full">
          <i class="fas fa-cart-shopping text-purple-600 text-xl"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- ุงูุดุจูุฉ ุงูุฑุฆูุณูุฉ -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    
    <!-- ุฅุญุตุงุฆูุงุช ุงูุทูุจูุงุช -->
    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-6">๐ฆ ุฅุญุตุงุฆูุงุช ุงูุทูุจูุงุช</h3>
      <div class="space-y-6">
        <!-- ุชูุฒูุน ุงูุญุงูุงุช -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">ุชูุฒูุน ุงูุทูุจูุงุช ุญุณุจ ุงูุญุงูุฉ</h4>
          <div class="space-y-3">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">ุงูุทูุจูุงุช ุงููุฏููุนุฉ</span>
              <div class="flex items-center gap-3">
                <div class="w-32 bg-gray-200 rounded-full h-2">
                  <div class="bg-green-600 h-2 rounded-full" style="width: {{ (paid_orders / total_orders * 100) if total_orders > 0 else 0 }}%"></div>
                </div>
                <span class="text-sm font-medium text-gray-900">{{ paid_orders }}</span>
              </div>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">ุงูุทูุจูุงุช ููุฏ ุงูุชูููุฐ</span>
              <div class="flex items-center gap-3">
                <div class="w-32 bg-gray-200 rounded-full h-2">
                  <div class="bg-yellow-600 h-2 rounded-full" style="width: {{ (pending_orders / total_orders * 100) if total_orders > 0 else 0 }}%"></div>
                </div>
                <span class="text-sm font-medium text-gray-900">{{ pending_orders }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ุงูุฅูุฑุงุฏุงุช -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">ุงูุฅูุฑุงุฏุงุช ุงููุงููุฉ</h4>
          <div class="grid grid-cols-2 gap-4">
            <div class="text-center p-4 bg-green-50 rounded-lg">
              <div class="text-2xl font-bold text-green-600">{{ "%.2f"|format(total_orders_amount) }} ุฏุฌ</div>
              <div class="text-sm text-green-700 mt-1">ุฅุฌูุงูู ูููุฉ ุงูุทูุจูุงุช</div>
            </div>
            <div class="text-center p-4 bg-blue-50 rounded-lg">
              <div class="text-2xl font-bold text-blue-600">
                {% if total_orders > 0 %}
                {{ "%.2f"|format(total_orders_amount / total_orders) }}
                {% else %}0{% endif %} ุฏุฌ
              </div>
              <div class="text-sm text-blue-700 mt-1">ูุชูุณุท ูููุฉ ุงูุทูุจูุฉ</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ุฅุญุตุงุฆูุงุช ุงูุนูุงู -->
    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-6">๐ฅ ุฅุญุตุงุฆูุงุช ุงูุนูุงู</h3>
      <div class="space-y-6">
        <!-- ุงูุฑูุงุชุจ -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">ุงูุฑูุงุชุจ ูุงููุณุชุญูุงุช</h4>
          <div class="grid grid-cols-2 gap-4">
            <div class="text-center p-4 bg-purple-50 rounded-lg">
              <div class="text-2xl font-bold text-purple-600">{{ "%.2f"|format(total_salaries) }} ุฏุฌ</div>
              <div class="text-sm text-purple-700 mt-1">ุฅุฌูุงูู ุงููุณุชุญูุงุช</div>
            </div>
            <div class="text-center p-4 bg-orange-50 rounded-lg">
              <div class="text-2xl font-bold text-orange-600">
                {% if total_workers > 0 %}
                {{ "%.2f"|format(total_salaries / total_workers) }}
                {% else %}0{% endif %} ุฏุฌ
              </div>
              <div class="text-sm text-orange-700 mt-1">ูุชูุณุท ุงูุฑุงุชุจ</div>
            </div>
          </div>
        </div>

        <!-- ุงูุบูุงุจ ูุงูุนูู ุงูุฎุงุฑุฌู -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">ุงูุญุถูุฑ ูุงูุบูุงุจ</h4>
          <div class="space-y-3">
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-700">ุฅุฌูุงูู ุฃูุงู ุงูุบูุงุจ</span>
              <span class="font-semibold text-red-600">{{ workers|sum(attribute='absences') }} ููู</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-700">ุฅุฌูุงูู ุฃูุงู ุงูุนูู ุงูุฎุงุฑุฌู</span>
              <span class="font-semibold text-green-600">{{ workers|sum(attribute='outside_work_days') }} ููู</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ุงูุดุจูุฉ ุงูุซุงููุฉ -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    
    <!-- ุฅุญุตุงุฆูุงุช ุงูุฏููู -->
    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-6">๐ฐ ุฅุญุตุงุฆูุงุช ุงูุฏููู</h3>
      <div class="space-y-6">
        <!-- ุชูุฒูุน ุงูุฏููู -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">ุชูุฒูุน ุงูุฏููู</h4>
          <div class="space-y-3">
            <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg">
              <div class="flex items-center gap-3">
                <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                <span class="text-gray-700">ุฏููู ุบูุฑ ูุฏููุนุฉ</span>
              </div>
              <div class="text-right">
                <div class="font-semibold text-red-600">{{ debts_unpaid }}</div>
                <div class="text-sm text-gray-500">{{ "%.2f"|format(total_debts_amount) }} ุฏุฌ</div>
              </div>
            </div>
            <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
              <div class="flex items-center gap-3">
                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                <span class="text-gray-700">ุฏููู ูุฏููุนุฉ</span>
              </div>
              <div class="text-right">
                <div class="font-semibold text-green-600">{{ debts_paid }}</div>
                <div class="text-sm text-gray-500">{{ "%.2f"|format(debts_paid_amount) }} ุฏุฌ</div>
              </div>
            </div>
          </div>
        </div>

        <!-- ูุนุฏู ุงูุณุฏุงุฏ -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">ูุนุฏู ุงูุณุฏุงุฏ</h4>
          <div class="text-center p-6 bg-blue-50 rounded-lg">
            <div class="text-3xl font-bold text-blue-600">
              {% if total_debts > 0 %}
              {{ "%.1f"|format((debts_paid / total_debts * 100)) }}
              {% else %}100{% endif %}%
            </div>
            <div class="text-blue-700 mt-2">ูุนุฏู ุณุฏุงุฏ ุงูุฏููู</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ุฅุญุตุงุฆูุงุช ุงููุดุชุฑูุงุช -->
    <div class="card p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-6">๐ ุฅุญุตุงุฆูุงุช ุงููุดุชุฑูุงุช</h3>
      <div class="space-y-6">
        <!-- ุฃููุงุน ุงููุดุชุฑูุงุช -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">ุชูุฒูุน ุงููุดุชุฑูุงุช</h4>
          <div class="grid grid-cols-2 gap-4">
            <div class="text-center p-4 bg-blue-50 rounded-lg">
              <div class="text-2xl font-bold text-blue-600">{{ fixed_purchases }}</div>
              <div class="text-sm text-blue-700 mt-1">ูุดุชุฑูุงุช ุซุงุจุชุฉ</div>
            </div>
            <div class="text-center p-4 bg-green-50 rounded-lg">
              <div class="text-2xl font-bold text-green-600">{{ variable_purchases }}</div>
              <div class="text-sm text-green-700 mt-1">ูุดุชุฑูุงุช ูุชุบูุฑุฉ</div>
            </div>
          </div>
        </div>

        <!-- ุญุงูุฉ ุงูุฏูุน -->
        <div>
          <h4 class="font-semibold text-gray-900 mb-4">ุญุงูุฉ ุงูุฏูุน</h4>
          <div class="space-y-3">
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-700">ุงููุดุชุฑูุงุช ุงููุฏููุนุฉ</span>
              <span class="font-semibold text-green-600">{{ purchases_paid }}</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
              <span class="text-gray-700">ุงููุดุชุฑูุงุช ุบูุฑ ุงููุฏููุนุฉ</span>
              <span class="font-semibold text-red-600">{{ purchases_unpaid }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ุงูุชูุงุฑูุฑ ุงูุณุฑูุนุฉ -->
  <div class="card p-6">
    <h3 class="text-xl font-bold text-gray-900 mb-6">๐ ุชูุงุฑูุฑ ุณุฑูุนุฉ</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      
      <!-- ุฃุฏุงุก ุงููุธุงู -->
      <div class="text-center p-4 bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl">
        <i class="fas fa-chart-line text-3xl mb-3"></i>
        <div class="text-2xl font-bold">{{ total_orders }}</div>
        <div class="text-sm opacity-90">ุทูุจูุฉ ูุฐุง ุงูุดูุฑ</div>
      </div>

      <!-- ุงูุฅูุฑุงุฏุงุช -->
      <div class="text-center p-4 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl">
        <i class="fas fa-money-bill-wave text-3xl mb-3"></i>
        <div class="text-2xl font-bold">{{ "%.2f"|format(total_orders_amount) }} ุฏุฌ</div>
        <div class="text-sm opacity-90">ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช</div>
      </div>

      <!-- ุงููููุงุช -->
      <div class="text-center p-4 bg-gradient-to-br from-red-500 to-red-600 text-white rounded-xl">
        <i class="fas fa-credit-card text-3xl mb-3"></i>
        <div class="text-2xl font-bold">{{ "%.2f"|format(total_salaries + total_debts_amount) }} ุฏุฌ</div>
        <div class="text-sm opacity-90">ุฅุฌูุงูู ุงููููุงุช</div>
      </div>
    </div>

    <!-- ุตุงูู ุงูุฑุจุญ -->
    <div class="mt-6 p-4 bg-gray-50 rounded-lg text-center">
      <div class="text-lg font-semibold text-gray-700">ุตุงูู ุงูุฑุจุญ</div>
      <div class="text-3xl font-bold {% if (total_orders_amount - (total_salaries + total_debts_amount)) >= 0 %}text-green-600{% else %}text-red-600{% endif %}">
        {{ "%.2f"|format(total_orders_amount - (total_salaries + total_debts_amount)) }} ุฏุฌ
      </div>
    </div>
  </div>

  <!-- ุงูููุฎุต ุงูุดูุฑู -->
  <div class="card p-6 mt-8">
    <h3 class="text-xl font-bold text-gray-900 mb-6">๐ ููุฎุต ุงูุฃุฏุงุก ุงูุดูุฑู</h3>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <div class="text-center p-4 border border-gray-200 rounded-lg">
        <div class="text-sm text-gray-600">ููุงุกุฉ ุงููุธุงู</div>
        <div class="text-2xl font-bold text-green-600">
          {% set efficiency = ((paid_orders / total_orders * 100) if total_orders > 0 else 0) %}
          {{ "%.0f"|format(efficiency) }}%
        </div>
      </div>
      <div class="text-center p-4 border border-gray-200 rounded-lg">
        <div class="text-sm text-gray-600">ูุนุฏู ุงูููู</div>
        <div class="text-2xl font-bold text-blue-600">+15%</div>
      </div>
      <div class="text-center p-4 border border-gray-200 rounded-lg">
        <div class="text-sm text-gray-600">ุฑุถุง ุงูุนููุงุก</div>
        <div class="text-2xl font-bold text-purple-600">94%</div>
      </div>
      <div class="text-center p-4 border border-gray-200 rounded-lg">
        <div class="text-sm text-gray-600">ุฅูุชุงุฌูุฉ ุงูุนูุงู</div>
        <div class="text-2xl font-bold text-orange-600">88%</div>
      </div>
    </div>
  </div>
</div>

<!-- ุณุชุงูู ุฅุถุงูู -->
<style>
.card {
  transition: all 0.3s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
}

/* ุชุฎุตูุต ุดุฑูุท ุงูุชูุฏู */
.progress-bar {
  transition: width 0.5s ease-in-out;
}

/* ุชุฃุซูุฑุงุช ููุจุทุงูุงุช ุงูููููุฉ */
.bg-gradient-to-br {
  background-size: 200% 200%;
  animation: gradientShift 3s ease infinite;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
</style>

<script>
// ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ูู ุงูููุช ุงูุญูููู
function updateLiveStats() {
  // ููุง ูููู ุฅุถุงูุฉ ููุฏ ูุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ูู ุงูุณูุฑูุฑ
  console.log('ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช...');
}

// ุชููุฆุฉ ุงูุฑุณูู ุงูุจูุงููุฉ
document.addEventListener('DOMContentLoaded', function() {
  // ูููู ุฅุถุงูุฉ ููุชุจุงุช ุงูุฑุณูู ุงูุจูุงููุฉ ููุง ูุซู Chart.js
  console.log('ุชููุฆุฉ ููุญุฉ ุงูุฅุญุตุงุฆูุงุช...');
  
  // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ูู 30 ุซุงููุฉ
  setInterval(updateLiveStats, 30000);
});

// ุทุจุงุนุฉ ุงูุชูุฑูุฑ
function printReport() {
  window.print();
}

// ุชุตุฏูุฑ ุงูุชูุฑูุฑ
function exportReport() {
  alert('ููุฒุฉ ุชุตุฏูุฑ ุงูุชูุฑูุฑ ููุฏ ุงูุชุทููุฑ');
}
</script>

<!-- ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช -->
<div class="fixed bottom-6 left-6 flex gap-3">
  <button onclick="printReport()" class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-lg shadow-lg hover:bg-gray-50 transition-colors flex items-center gap-2">
    <i class="fas fa-print"></i>
    ุทุจุงุนุฉ ุงูุชูุฑูุฑ
  </button>
  <button onclick="exportReport()" class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-blue-700 transition-colors flex items-center gap-2">
    <i class="fas fa-download"></i>
    ุชุตุฏูุฑ ุงูุชูุฑูุฑ
  </button>
</div>
{% endblock %}