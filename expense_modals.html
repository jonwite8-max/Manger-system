<!-- ููุฏุงู ุงูุฅุถุงูุฉ ุงูุณุฑูุนุฉ -->
<div id="quickAddModal" class="modal">
  <div class="modal-content max-w-md">
    <div class="modal-header">
      <h3 class="text-xl font-bold text-gray-900">โก ุฅุถุงูุฉ ูุตุฑูู ุณุฑูุน</h3>
      <button onclick="hideModal('quickAddModal')" class="modal-close">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <form method="POST" action="{{ url_for('quick_add_expense') }}" class="p-6 space-y-4" id="quickAddForm">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">๐ ุงูุชุตููู</label>
        <select name="category_id" class="form-select" required>
          {% for category in categories %}
          <option value="{{ category.id }}">{{ category.icon }} {{ category.name }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">๐ ุงููุตู</label>
        <input type="text" name="description" class="form-input" placeholder="ูุตู ุงููุตุฑูู" required>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">๐ฐ ุงููุจูุบ (ุฏุฌ)</label>
        <input type="number" step="0.01" name="amount" class="form-input" placeholder="0.00" required>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">๐ค ุงููุดุชุฑู</label>
        <select name="purchased_by" class="form-select">
          <option value="owner">ุฃูุง</option>
          <option value="partner">ุงูุดุฑูู</option>
          <option value="worker">ุนุงูู</option>
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">๐ข ุงูููุฑุฏ (ุงุฎุชูุงุฑู)</label>
        <select name="supplier_id" class="form-select">
          <option value="">-- ุงุฎุชุฑ ุงูููุฑุฏ --</option>
          {% for supplier in suppliers %}
          <option value="{{ supplier.id }}">{{ supplier.name }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">๐ ููุงุญุธุงุช</label>
        <textarea name="notes" class="form-input" rows="2" placeholder="ููุงุญุธุงุช ุฅุถุงููุฉ"></textarea>
      </div>
      
      <div class="flex justify-end gap-3 pt-4">
        <button type="button" onclick="hideModal('quickAddModal')" class="btn-secondary">ุฅูุบุงุก</button>
        <button type="submit" class="btn-success">ุฅุถุงูุฉ</button>
      </div>
    </form>
  </div>
</div>

<!-- ููุฏุงู ุฅุถุงูุฉ ูุตุฑูู ูุงูู -->
<div id="addExpenseModal" class="modal">
  <div class="modal-content max-w-4xl">
    <div class="modal-header">
      <h3 class="text-xl font-bold text-gray-900">๐ฐ ุฅุถุงูุฉ ูุตุฑูู ุฌุฏูุฏ</h3>
      <button onclick="hideModal('addExpenseModal')" class="modal-close">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <form method="POST" action="{{ url_for('add_expense') }}" class="p-6 space-y-6" id="expenseForm">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- ุงูุนููุฏ ุงูุฃูู -->
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">๐ ุงูุชุตููู *</label>
            <select name="category_id" class="form-select" required>
              {% for category in categories %}
              <option value="{{ category.id }}">{{ category.icon }} {{ category.name }}</option>
              {% endfor %}
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">๐ ุงููุตู *</label>
            <input type="text" name="description" class="form-input" placeholder="ูุตู ุงููุตุฑูู ุฃู ุงูููุชุฌ" required>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">๐ฐ ุณุนุฑ ุงููุญุฏุฉ (ุฏุฌ) *</label>
              <input type="number" step="0.01" name="unit_price" class="form-input" placeholder="0.00" required id="unitPrice" oninput="calculateTotal()">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">๐ข ุงููููุฉ *</label>
              <input type="number" name="quantity" class="form-input" value="1" required id="quantity" oninput="calculateTotal()">
            </div>
          </div>
          
          <div class="bg-gray-50 rounded-lg p-4">
            <div class="flex justify-between items-center">
              <span class="text-sm font-medium text-gray-700">๐งฎ ุงูุฅุฌูุงูู:</span>
              <span id="totalPreview" class="text-lg font-bold text-purple-600">0.00 ุฏุฌ</span>
            </div>
          </div>
        </div>
        
        <!-- ุงูุนููุฏ ุงูุซุงูู -->
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">๐ข ุงูููุฑุฏ (ุงุฎุชูุงุฑู)</label>
            <select name="supplier_id" class="form-select">
              <option value="">-- ุงุฎุชุฑ ุงูููุฑุฏ --</option>
              {% for supplier in suppliers %}
              <option value="{{ supplier.id }}">{{ supplier.name }}</option>
              {% endfor %}
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">๐ค ุงููุดุชุฑู *</label>
            <select name="purchased_by" class="form-select" required>
              <option value="owner">ุฃูุง</option>
              <option value="partner">ุงูุดุฑูู</option>
              <option value="worker">ุนุงูู</option>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">๐ ุชุงุฑูุฎ ุงูุดุฑุงุก *</label>
            <input type="date" name="purchase_date" class="form-input" value="{{ now.strftime('%Y-%m-%d') if now else '' }}" required>
          </div>
          
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">๐ฐ ุญุงูุฉ ุงูุฏูุน</label>
              <select name="payment_status" class="form-select">
                <option value="paid">ูุฏููุนุฉ</option>
                <option value="unpaid">ุบูุฑ ูุฏููุนุฉ</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">๐ณ ุทุฑููุฉ ุงูุฏูุน</label>
              <select name="payment_method" class="form-select">
                <option value="cash">ููุฏู</option>
                <option value="check">ุดูู</option>
                <option value="transfer">ุชุญููู</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">๐ ููุงุญุธุงุช ุฅุถุงููุฉ</label>
        <textarea name="notes" class="form-input" rows="3" placeholder="ููุงุญุธุงุช ุฅุถุงููุฉ ุญูู ุงููุตุฑูู..."></textarea>
      </div>
      
      <div class="flex items-center">
        <input type="checkbox" name="save_to_price_history" value="yes" id="savePriceHistory" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
        <label for="savePriceHistory" class="ml-2 text-sm text-gray-700">๐พ ุญูุธ ูู ุณุฌู ุฃุณุนุงุฑ ุงูููุชุฌุงุช</label>
      </div>
      
      <div class="flex justify-end gap-3 pt-6 border-t">
        <button type="button" onclick="hideModal('addExpenseModal')" class="btn-secondary">ุฅูุบุงุก</button>
        <button type="submit" class="btn-success">ุฅุถุงูุฉ ุงููุตุฑูู</button>
      </div>
    </form>
  </div>
</div>

<script>
// ุฏุงูุฉ ุญุณุงุจ ุงูุฅุฌูุงูู
function calculateTotal() {
    const unitPrice = parseFloat(document.getElementById('unitPrice').value) || 0;
    const quantity = parseInt(document.getElementById('quantity').value) || 1;
    const total = unitPrice * quantity;
    
    document.getElementById('totalPreview').textContent = total.toFixed(2) + ' ุฏุฌ';
}

// ุฅุฑุณุงู ุงููููุฐุฌ ุจุงุณุชุฎุฏุงู AJAX ูููุน ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ
document.getElementById('expenseForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    fetch(this.action, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            hideModal('addExpenseModal');
            location.reload(); // ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ูุนุฑุถ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ
        } else {
            alert('ุฎุทุฃ: ' + data.error);
        }
    })
    .catch(error => {
        alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฅุถุงูุฉ: ' + error);
    });
});

// ููุณ ุงูุดูุก ูููููุฐุฌ ุงูุณุฑูุน
document.getElementById('quickAddForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    fetch(this.action, {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            hideModal('quickAddModal');
            location.reload();
        } else {
            alert('ุฎุทุฃ: ' + data.error);
        }
    })
    .catch(error => {
        alert('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฅุถุงูุฉ: ' + error);
    });
});

// ุงูุชููุฆุฉ ุนูุฏ ูุชุญ ุงูููุฏุงู
document.addEventListener('DOMContentLoaded', function() {
    // ุชุนููู ุชุงุฑูุฎ ุงูููู ููููุฉ ุงูุชุฑุงุถูุฉ
    const today = new Date().toISOString().split('T')[0];
    const dateInputs = document.querySelectorAll('input[type="date"]');
    dateInputs.forEach(input => {
        if (!input.value) {
            input.value = today;
        }
    });
    
    // ุญุณุงุจ ุงูุฅุฌูุงูู ุงูุฃููู
    calculateTotal();
});
</script>